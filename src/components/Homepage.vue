<template>
  <div class="homebody">
    <h2>{{ msg }}</h2>

    <ul>
      <p style="margin-left: 20px; margin-right: 50px; margin-bottom: 15px">
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;In 2019, a new coronavirus was identified
        and had changed the humanity's society tremendously. How should we face
        the “after-covid-19” era becomes the top issue among almost all people.
        This dashboard presents the worldwide impacts of Covid-19 from multiple
        dimensions, and it mainly visualizes the answers to the following
        questions:
      </p>
      <li style="margin-top: -20px; margin-left: 190px; font-size: 14px">
        <i
          >How has the pandemic negatively impacted the public health system in
          different countries as time goes on?
        </i>
      </li>
      <li style="margin-left: 190px; font-size: 14px">
        <i>How did the global education system change during Covid-19?</i>
      </li>
      <li style="margin-left: 190px; font-size: 14px">
        <i
          >How did Covid-19 affect the global economy and financial markets?
        </i>
      </li>
    </ul>
    <div
      id="map"
      class="
        map map-home
        leaflet-container
        leaflet-touch
        leaflet-fade-anim
        leaflet-grab
        leaflet-touch-drag
        leaflet-touch-zoom
      "
    ></div>
    <h6 style="color: red; margin: 20px auto">
      Toggle slider or Click slider + press &rightarrow; / &leftarrow; to change
      date
    </h6>
    <b-row class="justify-content-md-center">
      <b-col col lg="6">
        <input id="slider1" style="width: 100%" />
      </b-col>
      <b-col col lg="1"><span id="slider_date"></span> </b-col>
    </b-row>
    <div id="map_table">
      <h6 style="color: red">
        Click the area in the map to add Country/Region to table;
      </h6>
      <h6 style="color: red">Click " X " button to remove row.</h6>
      <b-table striped :fields="fields"></b-table>
    </div>
    <hr />
    <b-container id="scatter_" hidden>
      <h2 style="text-align: center; margin: 10px auto">
        Scatter Plot by Dimension
      </h2>

      <h6 style="color: red; margin: 20px auto">
        Click plot to generate the graph!
      </h6>

      <b-row class="justify-content-md-center">
        <b-col col lg="3">
          <label>X-Axis: </label>
          <select id="c0" style="margin-left: 7px"></select>
        </b-col>
        <b-col col lg="3">
          <label>Y-Axis: </label>
          <select id="c1" style="margin-left: 7px"></select>
        </b-col>
        <b-col col lg="3">
          <label> Size:</label>
          <select style="margin-left: 7px" id="c2"></select>
        </b-col>
        <b-col col lg="1">
          <button style="margin: auto auto" id="scatter_button">Plot</button>
        </b-col>
      </b-row>
      <!-- <input type = "submit" onclick = draw() /> -->
      <b-row class="justify-content-md-center">
        <b-col col lg="12" id="scatter_plot" style="margin-top: 40px"></b-col>
      </b-row>
    </b-container>
  </div>
</template>



<script>
import * as d3 from "d3";
import $L from "leaflet";
import "leaflet/dist/leaflet.css";

export default {
  name: "HomePage",
  props: {
    msg: String,
    // data: Object,
  },
  data() {
    return {
      fields: [
        "Country/Region",
        "GDP (bil $)",
        "Change in GDP (%)",
        "School Status",
        "Daily Confirm",
        "Daily Death",
        { key: "remove", label: "" },
      ],
    };
  },
  methods: {},
  mounted() {
    var data;

    d3.json("integrated_alldata.geojson").then((result) => {
      // console.log(result);
      data = result;

      /* Global variable to store info in the table for scatter plot*/
      var table_items = [];

      const mapboxAccessToken =
        "pk.eyJ1Ijoic2hpaGFvbGluIiwiYSI6ImNrdjJiZmFjYTA4cjAycG9iZGUxMmw5bTMifQ.7aH7rV0sh3IvK4GgUABnUg";
      // set default value for slider
      d3.select("#slider1")
        .attr("type", "range")
        // .attr("min", new Date("2020.02.01").getTime() / 1000)
        // .attr("max", new Date("2021.11.05").getTime() / 1000)
        .attr("min", Date.UTC(2020, 1, 1) / 1000)
        .attr("max", Date.UTC(2021, 10, 5) / 1000)
        .attr("step", 86400)
        .attr("value", Date.UTC(2020, 12, 1) / 1000);
      // .attr("value", new Date("2020.02.01").getTime() / 1000);
      d3.select("#slider_date").text(new Date("2021.01.01").toDateString());
      /* Global variables for Map*/
      var cur_time = new Date(d3.select("#slider1").node().value * 1000);

      var map_filter_attr;

      // value formater section
      var gdp_format = d3.format("$,.3~f");

      var positive_format = d3.format(",");

      // initiate time bound
      // Therefore, if current slider time is still within the boundary,
      // do no need for the update the map.
      // #### Currently, we would disable this functionality since time bound is 1 if we use daily data
      // var time_low, time_upper

      /* Time Scaler Section */
      // TODO: ADD more cases
      // 2019 is lower bound, 2022 is upper bound, we only care about 2020 and 2021
      var gdp_threshold = ["2019", "2020", "2021", "2022"].map(
          (v) => new Date(v, 0)
        ),
        gdp_time = d3
          .scaleThreshold()
          .domain(gdp_threshold.slice(1))
          .range(gdp_threshold.map((v) => v.getFullYear()));

      // console.log(gdp_threshold)
      //  console.log(gdp_threshold.slice(1))
      //  console.log(gdp_threshold.map((v) => v.getFullYear()))
      // console.log(cur_time.toDateString())
      // console.log(gdp_time(cur_time),new Date(gdp_time(cur_time)).toDateString())

      var school_threshold = [
          1581711100000,
          1581811200000,
          1581897600000,
          1581984000000,
          1582070400000,
          1582156800000,
          1582243200000,
          1582329600000,
          1582416000000,
          1582502400000,
          1582588800000,
          1582675200000,
          1582761600000,
          1582848000000,
          1582934400000,
          1583020800000,
          1583107200000,
          1583193600000,
          1583280000000,
          1583366400000,
          1583452800000,
          1583539200000,
          1583625600000,
          1583712000000,
          1583798400000,
          1583884800000,
          1583971200000,
          1584057600000,
          1584144000000,
          1584230400000,
          1584316800000,
          1584403200000,
          1584489600000,
          1584576000000,
          1584662400000,
          1584748800000,
          1584835200000,
          1584921600000,
          1585008000000,
          1585094400000,
          1585180800000,
          1585267200000,
          1585353600000,
          1585440000000,
          1585526400000,
          1585612800000,
          1585699200000,
          1585785600000,
          1585872000000,
          1585958400000,
          1586044800000,
          1586131200000,
          1586217600000,
          1586304000000,
          1586390400000,
          1586476800000,
          1586563200000,
          1586649600000,
          1586736000000,
          1586822400000,
          1586908800000,
          1586995200000,
          1587081600000,
          1587168000000,
          1587254400000,
          1587340800000,
          1587427200000,
          1587513600000,
          1587600000000,
          1587686400000,
          1587772800000,
          1587859200000,
          1587945600000,
          1588032000000,
          1588118400000,
          1588204800000,
          1588291200000,
          1588377600000,
          1588464000000,
          1588550400000,
          1588636800000,
          1588723200000,
          1588809600000,
          1588896000000,
          1588982400000,
          1589068800000,
          1589155200000,
          1589241600000,
          1589328000000,
          1589414400000,
          1589500800000,
          1589587200000,
          1589673600000,
          1589760000000,
          1589846400000,
          1589932800000,
          1590019200000,
          1590105600000,
          1590192000000,
          1590278400000,
          1590364800000,
          1590451200000,
          1590537600000,
          1590624000000,
          1590710400000,
          1590796800000,
          1590883200000,
          1590969600000,
          1591056000000,
          1591142400000,
          1591228800000,
          1591315200000,
          1591401600000,
          1591488000000,
          1591574400000,
          1591660800000,
          1591747200000,
          1591833600000,
          1591920000000,
          1592006400000,
          1592092800000,
          1592179200000,
          1592265600000,
          1592352000000,
          1592438400000,
          1592524800000,
          1592611200000,
          1592697600000,
          1592784000000,
          1592870400000,
          1592956800000,
          1593043200000,
          1593129600000,
          1593216000000,
          1593302400000,
          1593388800000,
          1593475200000,
          1593561600000,
          1593648000000,
          1593734400000,
          1593820800000,
          1593907200000,
          1593993600000,
          1594080000000,
          1594166400000,
          1594252800000,
          1594339200000,
          1594425600000,
          1594512000000,
          1594598400000,
          1594684800000,
          1594771200000,
          1594857600000,
          1594944000000,
          1595030400000,
          1595116800000,
          1595203200000,
          1595289600000,
          1595376000000,
          1595462400000,
          1595548800000,
          1595635200000,
          1595721600000,
          1595808000000,
          1595894400000,
          1595980800000,
          1596067200000,
          1596153600000,
          1596240000000,
          1596326400000,
          1596412800000,
          1596499200000,
          1596585600000,
          1596672000000,
          1596758400000,
          1596844800000,
          1596931200000,
          1597017600000,
          1597104000000,
          1597190400000,
          1597276800000,
          1597363200000,
          1597449600000,
          1597536000000,
          1597622400000,
          1597708800000,
          1597795200000,
          1597881600000,
          1597968000000,
          1598054400000,
          1598140800000,
          1598227200000,
          1598313600000,
          1598400000000,
          1598486400000,
          1598572800000,
          1598659200000,
          1598745600000,
          1598832000000,
          1598918400000,
          1599004800000,
          1599091200000,
          1599177600000,
          1599264000000,
          1599350400000,
          1599436800000,
          1599523200000,
          1599609600000,
          1599696000000,
          1599782400000,
          1599868800000,
          1599955200000,
          1600041600000,
          1600128000000,
          1600214400000,
          1600300800000,
          1600387200000,
          1600473600000,
          1600560000000,
          1600646400000,
          1600732800000,
          1600819200000,
          1600905600000,
          1600992000000,
          1601078400000,
          1601164800000,
          1601251200000,
          1601337600000,
          1601424000000,
          1601510400000,
          1601596800000,
          1601683200000,
          1601769600000,
          1601856000000,
          1601942400000,
          1602028800000,
          1602115200000,
          1602201600000,
          1602288000000,
          1602374400000,
          1602460800000,
          1602547200000,
          1602633600000,
          1602720000000,
          1602806400000,
          1602892800000,
          1602979200000,
          1603065600000,
          1603152000000,
          1603238400000,
          1603324800000,
          1603411200000,
          1603497600000,
          1603584000000,
          1603670400000,
          1603756800000,
          1603843200000,
          1603929600000,
          1604016000000,
          1604102400000,
          1604188800000,
          1604275200000,
          1604361600000,
          1604448000000,
          1604534400000,
          1604620800000,
          1604707200000,
          1604793600000,
          1604880000000,
          1604966400000,
          1605052800000,
          1605139200000,
          1605225600000,
          1605312000000,
          1605398400000,
          1605484800000,
          1605571200000,
          1605657600000,
          1605744000000,
          1605830400000,
          1605916800000,
          1606003200000,
          1606089600000,
          1606176000000,
          1606262400000,
          1606348800000,
          1606435200000,
          1606521600000,
          1606608000000,
          1606694400000,
          1606780800000,
          1606867200000,
          1606953600000,
          1607040000000,
          1607126400000,
          1607212800000,
          1607299200000,
          1607385600000,
          1607472000000,
          1607558400000,
          1607644800000,
          1607731200000,
          1607817600000,
          1607904000000,
          1607990400000,
          1608076800000,
          1608163200000,
          1608249600000,
          1608336000000,
          1608422400000,
          1608508800000,
          1608595200000,
          1608681600000,
          1608768000000,
          1608854400000,
          1608940800000,
          1609027200000,
          1609113600000,
          1609200000000,
          1609286400000,
          1609372800000,
          1609459200000,
          1609545600000,
          1609632000000,
          1609718400000,
          1609804800000,
          1609891200000,
          1609977600000,
          1610064000000,
          1610150400000,
          1610236800000,
          1610323200000,
          1610409600000,
          1610496000000,
          1610582400000,
          1610668800000,
          1610755200000,
          1610841600000,
          1610928000000,
          1611014400000,
          1611100800000,
          1611187200000,
          1611273600000,
          1611360000000,
          1611446400000,
          1611532800000,
          1611619200000,
          1611705600000,
          1611792000000,
          1611878400000,
          1611964800000,
          1612051200000,
          1612137600000,
          1612224000000,
          1612310400000,
          1612396800000,
          1612483200000,
          1612569600000,
          1612656000000,
          1612742400000,
          1612828800000,
          1612915200000,
          1613001600000,
          1613088000000,
          1613174400000,
          1613260800000,
          1613347200000,
          1613433600000,
          1613520000000,
          1613606400000,
          1613692800000,
          1613779200000,
          1613865600000,
          1613952000000,
          1614038400000,
          1614124800000,
          1614211200000,
          1614297600000,
          1614384000000,
          1614470400000,
          1614556800000,
          1614643200000,
          1614729600000,
          1614816000000,
          1614902400000,
          1614988800000,
          1615075200000,
          1615161600000,
          1615248000000,
          1615334400000,
          1615420800000,
          1615507200000,
          1615593600000,
          1615680000000,
          1615766400000,
          1615852800000,
          1615939200000,
          1616025600000,
          1616112000000,
          1616198400000,
          1616284800000,
          1616371200000,
          1616457600000,
          1616544000000,
          1616630400000,
          1616716800000,
          1616803200000,
          1616889600000,
          1616976000000,
          1617062400000,
          1617148800000,
          1617235200000,
          1617321600000,
          1617408000000,
          1617494400000,
          1617580800000,
          1617667200000,
          1617753600000,
          1617840000000,
          1617926400000,
          1618012800000,
          1618099200000,
          1618185600000,
          1618272000000,
          1618358400000,
          1618444800000,
          1618531200000,
          1618617600000,
          1618704000000,
          1618790400000,
          1618876800000,
          1618963200000,
          1619049600000,
          1619136000000,
          1619222400000,
          1619308800000,
          1619395200000,
          1619481600000,
          1619568000000,
          1619654400000,
          1619740800000,
          1619827200000,
          1619913600000,
          1620000000000,
          1620086400000,
          1620172800000,
          1620259200000,
          1620345600000,
          1620432000000,
          1620518400000,
          1620604800000,
          1620691200000,
          1620777600000,
          1620864000000,
          1620950400000,
          1621036800000,
          1621123200000,
          1621209600000,
          1621296000000,
          1621382400000,
          1621468800000,
          1621555200000,
          1621641600000,
          1621728000000,
          1621814400000,
          1621900800000,
          1621987200000,
          1622073600000,
          1622160000000,
          1622246400000,
          1622332800000,
          1622419200000,
          1622505600000,
          1622592000000,
          1622678400000,
          1622764800000,
          1622851200000,
          1622937600000,
          1623024000000,
          1623110400000,
          1623196800000,
          1623283200000,
          1623369600000,
          1623456000000,
          1623542400000,
          1623628800000,
          1623715200000,
          1623801600000,
          1623888000000,
          1623974400000,
          1624060800000,
          1624147200000,
          1624233600000,
          1624320000000,
          1624406400000,
          1624492800000,
          1624579200000,
          1624665600000,
          1624752000000,
          1624838400000,
          1624924800000,
          1625011200000,
          1625097600000,
          1625184000000,
          1625270400000,
          1625356800000,
          1625443200000,
          1625529600000,
          1625616000000,
          1625702400000,
          1625788800000,
          1625875200000,
          1625961600000,
          1626048000000,
          1626134400000,
          1626220800000,
          1626307200000,
          1626393600000,
          1626480000000,
          1626566400000,
          1626652800000,
          1626739200000,
          1626825600000,
          1626912000000,
          1626998400000,
          1627084800000,
          1627171200000,
          1627257600000,
          1627344000000,
          1627430400000,
          1627516800000,
          1627603200000,
          1627689600000,
          1627789600000, // this value is added to give a upper bound
        ].map((v) => new Date(v)),
        school_time = d3
          .scaleThreshold()
          .domain(school_threshold.slice(1))
          .range(school_threshold.map((v) => v.getTime()));

      var health_threshold = [
          1579651200000,
          1579737600000,
          1579824000000,
          1579910400000,
          1579996800000,
          1580083200000,
          1580169600000,
          1580256000000,
          1580342400000,
          1580428800000,
          1580515200000,
          1580601600000,
          1580688000000,
          1580774400000,
          1580860800000,
          1580947200000,
          1581033600000,
          1581120000000,
          1581206400000,
          1581292800000,
          1581379200000,
          1581465600000,
          1581552000000,
          1581638400000,
          1581724800000,
          1581811200000,
          1581897600000,
          1581984000000,
          1582070400000,
          1582156800000,
          1582243200000,
          1582329600000,
          1582416000000,
          1582502400000,
          1582588800000,
          1582675200000,
          1582761600000,
          1582848000000,
          1582934400000,
          1583020800000,
          1583107200000,
          1583193600000,
          1583280000000,
          1583366400000,
          1583452800000,
          1583539200000,
          1583625600000,
          1583712000000,
          1583798400000,
          1583884800000,
          1583971200000,
          1584057600000,
          1584144000000,
          1584230400000,
          1584316800000,
          1584403200000,
          1584489600000,
          1584576000000,
          1584662400000,
          1584748800000,
          1584835200000,
          1584921600000,
          1585008000000,
          1585094400000,
          1585180800000,
          1585267200000,
          1585353600000,
          1585440000000,
          1585526400000,
          1585612800000,
          1585699200000,
          1585785600000,
          1585872000000,
          1585958400000,
          1586044800000,
          1586131200000,
          1586217600000,
          1586304000000,
          1586390400000,
          1586476800000,
          1586563200000,
          1586649600000,
          1586736000000,
          1586822400000,
          1586908800000,
          1586995200000,
          1587081600000,
          1587168000000,
          1587254400000,
          1587340800000,
          1587427200000,
          1587513600000,
          1587600000000,
          1587686400000,
          1587772800000,
          1587859200000,
          1587945600000,
          1588032000000,
          1588118400000,
          1588204800000,
          1588291200000,
          1588377600000,
          1588464000000,
          1588550400000,
          1588636800000,
          1588723200000,
          1588809600000,
          1588896000000,
          1588982400000,
          1589068800000,
          1589155200000,
          1589241600000,
          1589328000000,
          1589414400000,
          1589500800000,
          1589587200000,
          1589673600000,
          1589760000000,
          1589846400000,
          1589932800000,
          1590019200000,
          1590105600000,
          1590192000000,
          1590278400000,
          1590364800000,
          1590451200000,
          1590537600000,
          1590624000000,
          1590710400000,
          1590796800000,
          1590883200000,
          1590969600000,
          1591056000000,
          1591142400000,
          1591228800000,
          1591315200000,
          1591401600000,
          1591488000000,
          1591574400000,
          1591660800000,
          1591747200000,
          1591833600000,
          1591920000000,
          1592006400000,
          1592092800000,
          1592179200000,
          1592265600000,
          1592352000000,
          1592438400000,
          1592524800000,
          1592611200000,
          1592697600000,
          1592784000000,
          1592870400000,
          1592956800000,
          1593043200000,
          1593129600000,
          1593216000000,
          1593302400000,
          1593388800000,
          1593475200000,
          1593561600000,
          1593648000000,
          1593734400000,
          1593820800000,
          1593907200000,
          1593993600000,
          1594080000000,
          1594166400000,
          1594252800000,
          1594339200000,
          1594425600000,
          1594512000000,
          1594598400000,
          1594684800000,
          1594771200000,
          1594857600000,
          1594944000000,
          1595030400000,
          1595116800000,
          1595203200000,
          1595289600000,
          1595376000000,
          1595462400000,
          1595548800000,
          1595635200000,
          1595721600000,
          1595808000000,
          1595894400000,
          1595980800000,
          1596067200000,
          1596153600000,
          1596240000000,
          1596326400000,
          1596412800000,
          1596499200000,
          1596585600000,
          1596672000000,
          1596758400000,
          1596844800000,
          1596931200000,
          1597017600000,
          1597104000000,
          1597190400000,
          1597276800000,
          1597363200000,
          1597449600000,
          1597536000000,
          1597622400000,
          1597708800000,
          1597795200000,
          1597881600000,
          1597968000000,
          1598054400000,
          1598140800000,
          1598227200000,
          1598313600000,
          1598400000000,
          1598486400000,
          1598572800000,
          1598659200000,
          1598745600000,
          1598832000000,
          1598918400000,
          1599004800000,
          1599091200000,
          1599177600000,
          1599264000000,
          1599350400000,
          1599436800000,
          1599523200000,
          1599609600000,
          1599696000000,
          1599782400000,
          1599868800000,
          1599955200000,
          1600041600000,
          1600128000000,
          1600214400000,
          1600300800000,
          1600387200000,
          1600473600000,
          1600560000000,
          1600646400000,
          1600732800000,
          1600819200000,
          1600905600000,
          1600992000000,
          1601078400000,
          1601164800000,
          1601251200000,
          1601337600000,
          1601424000000,
          1601510400000,
          1601596800000,
          1601683200000,
          1601769600000,
          1601856000000,
          1601942400000,
          1602028800000,
          1602115200000,
          1602201600000,
          1602288000000,
          1602374400000,
          1602460800000,
          1602547200000,
          1602633600000,
          1602720000000,
          1602806400000,
          1602892800000,
          1602979200000,
          1603065600000,
          1603152000000,
          1603238400000,
          1603324800000,
          1603411200000,
          1603497600000,
          1603584000000,
          1603670400000,
          1603756800000,
          1603843200000,
          1603929600000,
          1604016000000,
          1604102400000,
          1604188800000,
          1604275200000,
          1604361600000,
          1604448000000,
          1604534400000,
          1604620800000,
          1604707200000,
          1604793600000,
          1604880000000,
          1604966400000,
          1605052800000,
          1605139200000,
          1605225600000,
          1605312000000,
          1605398400000,
          1605484800000,
          1605571200000,
          1605657600000,
          1605744000000,
          1605830400000,
          1605916800000,
          1606003200000,
          1606089600000,
          1606176000000,
          1606262400000,
          1606348800000,
          1606435200000,
          1606521600000,
          1606608000000,
          1606694400000,
          1606780800000,
          1606867200000,
          1606953600000,
          1607040000000,
          1607126400000,
          1607212800000,
          1607299200000,
          1607385600000,
          1607472000000,
          1607558400000,
          1607644800000,
          1607731200000,
          1607817600000,
          1607904000000,
          1607990400000,
          1608076800000,
          1608163200000,
          1608249600000,
          1608336000000,
          1608422400000,
          1608508800000,
          1608595200000,
          1608681600000,
          1608768000000,
          1608854400000,
          1608940800000,
          1609027200000,
          1609113600000,
          1609200000000,
          1609286400000,
          1609372800000,
          1609459200000,
          1609545600000,
          1609632000000,
          1609718400000,
          1609804800000,
          1609891200000,
          1609977600000,
          1610064000000,
          1610150400000,
          1610236800000,
          1610323200000,
          1610409600000,
          1610496000000,
          1610582400000,
          1610668800000,
          1610755200000,
          1610841600000,
          1610928000000,
          1611014400000,
          1611100800000,
          1611187200000,
          1611273600000,
          1611360000000,
          1611446400000,
          1611532800000,
          1611619200000,
          1611705600000,
          1611792000000,
          1611878400000,
          1611964800000,
          1612051200000,
          1612137600000,
          1612224000000,
          1612310400000,
          1612396800000,
          1612483200000,
          1612569600000,
          1612656000000,
          1612742400000,
          1612828800000,
          1612915200000,
          1613001600000,
          1613088000000,
          1613174400000,
          1613260800000,
          1613347200000,
          1613433600000,
          1613520000000,
          1613606400000,
          1613692800000,
          1613779200000,
          1613865600000,
          1613952000000,
          1614038400000,
          1614124800000,
          1614211200000,
          1614297600000,
          1614384000000,
          1614470400000,
          1614556800000,
          1614643200000,
          1614729600000,
          1614816000000,
          1614902400000,
          1614988800000,
          1615075200000,
          1615161600000,
          1615248000000,
          1615334400000,
          1615420800000,
          1615507200000,
          1615593600000,
          1615680000000,
          1615766400000,
          1615852800000,
          1615939200000,
          1616025600000,
          1616112000000,
          1616198400000,
          1616284800000,
          1616371200000,
          1616457600000,
          1616544000000,
          1616630400000,
          1616716800000,
          1616803200000,
          1616889600000,
          1616976000000,
          1617062400000,
          1617148800000,
          1617235200000,
          1617321600000,
          1617408000000,
          1617494400000,
          1617580800000,
          1617667200000,
          1617753600000,
          1617840000000,
          1617926400000,
          1618012800000,
          1618099200000,
          1618185600000,
          1618272000000,
          1618358400000,
          1618444800000,
          1618531200000,
          1618617600000,
          1618704000000,
          1618790400000,
          1618876800000,
          1618963200000,
          1619049600000,
          1619136000000,
          1619222400000,
          1619308800000,
          1619395200000,
          1619481600000,
          1619568000000,
          1619654400000,
          1619740800000,
          1619827200000,
          1619913600000,
          1620000000000,
          1620086400000,
          1620172800000,
          1620259200000,
          1620345600000,
          1620432000000,
          1620518400000,
          1620604800000,
          1620691200000,
          1620777600000,
          1620864000000,
          1620950400000,
          1621036800000,
          1621123200000,
          1621209600000,
          1621296000000,
          1621382400000,
          1621468800000,
          1621555200000,
          1621641600000,
          1621728000000,
          1621814400000,
          1621900800000,
          1621987200000,
          1622073600000,
          1622160000000,
          1622246400000,
          1622332800000,
          1622419200000,
          1622505600000,
          1622592000000,
          1622678400000,
          1622764800000,
          1622851200000,
          1622937600000,
          1623024000000,
          1623110400000,
          1623196800000,
          1623283200000,
          1623369600000,
          1623456000000,
          1623542400000,
          1623628800000,
          1623715200000,
          1623801600000,
          1623888000000,
          1623974400000,
          1624060800000,
          1624147200000,
          1624233600000,
          1624320000000,
          1624406400000,
          1624492800000,
          1624579200000,
          1624665600000,
          1624752000000,
          1624838400000,
          1624924800000,
          1625011200000,
          1625097600000,
          1625184000000,
          1625270400000,
          1625356800000,
          1625443200000,
          1625529600000,
          1625616000000,
          1625702400000,
          1625788800000,
          1625875200000,
          1625961600000,
          1626048000000,
          1626134400000,
          1626220800000,
          1626307200000,
          1626393600000,
          1626480000000,
          1626566400000,
          1626652800000,
          1626739200000,
          1626825600000,
          1626912000000,
          1626998400000,
          1627084800000,
          1627171200000,
          1627257600000,
          1627344000000,
          1627430400000,
          1627516800000,
          1627603200000,
          1627689600000,
          1627776000000,
          1627862400000,
          1627948800000,
          1628035200000,
          1628121600000,
          1628208000000,
          1628294400000,
          1628380800000,
          1628467200000,
          1628553600000,
          1628640000000,
          1628726400000,
          1628812800000,
          1628899200000,
          1628985600000,
          1629072000000,
          1629158400000,
          1629244800000,
          1629331200000,
          1629417600000,
          1629504000000,
          1629590400000,
          1629676800000,
          1629763200000,
          1629849600000,
          1629936000000,
          1630022400000,
          1630108800000,
          1630195200000,
          1630281600000,
          1630368000000,
          1630454400000,
          1630540800000,
          1630627200000,
          1630713600000,
          1630800000000,
          1630886400000,
          1630972800000,
          1631059200000,
          1631145600000,
          1631232000000,
          1631318400000,
          1631404800000,
          1631491200000,
          1631577600000,
          1631664000000,
          1631750400000,
          1631836800000,
          1631923200000,
          1632009600000,
          1632096000000,
          1632182400000,
          1632268800000,
          1632355200000,
          1632441600000,
          1632528000000,
          1632614400000,
          1632700800000,
          1632787200000,
          1632873600000,
          1632960000000,
          1633046400000,
          1633132800000,
          1633219200000,
          1633305600000,
          1633392000000,
          1633478400000,
          1633564800000,
          1633651200000,
          1633737600000,
          1633824000000,
          1633910400000,
          1633996800000,
          1634083200000,
          1634169600000,
          1634256000000,
          1634342400000,
          1634428800000,
          1634515200000,
          1634601600000,
          1634688000000,
          1634774400000,
          1634860800000,
          1634947200000,
          1635033600000,
          1635120000000,
          1635206400000,
          1635292800000,
          1635379200000,
          1635465600000,
          1635552000000,
          1635638400000,
          1635724800000,
          1635811200000,
          1635897600000,
          1635984000000,
          1636070400000,
          1636156800000,
          1636243200000,
          1636329600000,
          1636416000000,
          1636502400000,
          1637789600000, // this value is added to give a upper bound
        ].map((v) => new Date(v)),
        health_time = d3
          .scaleThreshold()
          .domain(health_threshold.slice(1))
          .range(health_threshold.map((v) => v.getTime()));

      var color_covid_death = d3
        .scaleSequential()
        .domain([0, 300])
        .range(d3.schemeReds[3]);
      var color_covid_confirm = d3
        .scaleSequentialLog()
        .domain([0.1, 3])
        .range(d3.schemePurples[3]);

      /* Color Scaler Section*/
      // TODO: Add more cases if needed
      // define color functions for different type of data
      var color_school = d3.scaleOrdinal(
          [
            "Closed due to COVID-19",
            "Partially open",
            "Academic break",
            "Fully open",
          ],
          d3.schemeRdBu[4]
        ),
        // color_seq = d3.scaleSequential(d3.interpolateBlues),
        color_seq_log = d3.scaleSequentialLog(d3.interpolateBlues),
        gdp_domain = { 2020: [0.932, 20893.75], 2021: [0.999, 22939.58] };

      // default configuate for the leaflet map
      var bounds = new $L.LatLngBounds(
          new $L.LatLng(-60, -180),
          new $L.LatLng(84, 180)
        ),
        map = $L.map("map", {
          center: bounds.getCenter(),
          zoom: 2,
          minZoom: 1.8,
          maxZoom: 6,
          maxBounds: bounds,
          maxBoundsViscosity: 1.0,
        });
      // }).setView([37.8, -96], 2);
      function mapstyle(x) {
        /*TODO: ADD more cases */
        // feature dictionary with GeoJson Feature Collections

        let color;
        if (map_filter_attr == "gdp") {
          let input = gdp_time(cur_time);
          color = x.properties.gdp[input]
            ? color_seq_log.domain(gdp_domain[input])(x.properties.gdp[input])
            : "#B6B6B6";
        } else if (map_filter_attr == "school") {
          let input = school_time(cur_time);
          // time_low = school_time.invertExtent(input)[0]
          // time_upper = school_time.invertExtent(input)[1]
          color = x.properties.school[input]
            ? color_school(x.properties.school[input])
            : "#B6B6B6";
        } else if (map_filter_attr == "death") {
          let input = health_time(cur_time);
          // if(x.properties.admin == 'China')
          // {console.log(new Date(input), new Date(cur_time));console.log(x.properties.covid_death[input])}

          color =
            (x.properties.covid_death[input] != undefined) &
            (x.properties.covid_death[input] >= 0)
              ? color_covid_death(x.properties.covid_death[input])
              : "#B6B6B6";
        } else if (map_filter_attr == "confirm") {
          let input = health_time(cur_time);
          color =
            (x.properties.covid_confirm[input] != undefined) &
            (x.properties.covid_confirm[input] >= 0)
              ? color_covid_confirm(x.properties.covid_confirm[input])
              : "#B6B6B6";
        }

        color = color ? color : "#B6B6B6";
        return {
          fillColor: color,
          weight: 2,
          opacity: 1,
          color: "white",
          dashArray: "2",
          fillOpacity: 0.4,
        };
      }
      function highlightFeature(e) {
        var layer = e.target;

        layer.setStyle({
          weight: 5,
          color: "#666",
          dashArray: "",
          fillOpacity: 0.7,
        });

        if (!$L.Browser.ie && !$L.Browser.opera && !$L.Browser.edge) {
          layer.bringToFront();
        }

        // update info box
        info.update(layer.feature.properties);
      }
      function resetHighlight(e) {
        geojson.resetStyle(e.target);
        // update info box
        info.update();
      }
      // function zoomToFeature(e) {
      //   map.fitBounds(e.target.getBounds());
      // }
      function addTableRow(name) {
        // TODO: ADD more cases
        let props = data.features.filter((d) => d.properties.name == name)[0]
            .properties,
          gdp_txt = props.gdp[gdp_time(cur_time)]
            ? gdp_format(props.gdp[gdp_time(cur_time)])
            : "",
          gdp_change_txt =
            props.gdp[gdp_time(cur_time)] & props.gdp[gdp_time(cur_time) - 1]
              ? ((props.gdp[cur_time.getFullYear()] -
                  props.gdp[cur_time.getFullYear() - 1]) /
                  props.gdp[cur_time.getFullYear() - 1]) *
                100
              : "",
          school_txt = props.school[school_time(cur_time)]
            ? props.school[school_time(cur_time)]
            : "",
          confirm_txt =
            (props.covid_confirm[health_time(cur_time)] != undefined) &
            (props.covid_confirm[health_time(cur_time)] >= 0)
              ? props.covid_confirm[health_time(cur_time)]
              : "",
          death_txt =
            (props.covid_death[health_time(cur_time)] != undefined) &
            (props.covid_death[health_time(cur_time)] >= 0)
              ? props.covid_death[health_time(cur_time)]
              : "",
          table = d3.select("#map_table tbody");

        table_items = table_items.filter((d) => d.country.value != name);

        table_items.push({
          country: { key: "Country/Region", value: name },
          gdp: {
            key: "GDP (Billions of U.S.dollars)",
            value: props.gdp[gdp_time(cur_time)],
          },
          gdp_change: {
            key: "Change in GDP (%)",
            value: gdp_change_txt,
          },
          school: { key: "School Status", value: school_txt },
          confirm: { key: "Daily Confirm", value: confirm_txt },
          death: { key: "Daily Death", value: death_txt },
        });

        d3.select("#scatter_").attr("hidden", null);

        if (!table.select(`tr[name='${name}']`).node()) {
          let tmp_tr = table
            .append("tr")
            .attr("name", name)
            .attr("role", "row");
          tmp_tr.append("td").attr("role", "cell").text(name);
          tmp_tr.append("td").attr("role", "cell").text(gdp_txt);
          tmp_tr
            .append("td")
            .attr("role", "cell")
            .text(d3.format(",.3~f")(gdp_change_txt));
          tmp_tr.append("td").attr("role", "cell").text(school_txt);
          tmp_tr
            .append("td")
            .attr("role", "cell")
            .text(positive_format(confirm_txt));
          tmp_tr
            .append("td")
            .attr("role", "cell")
            .text(positive_format(death_txt));
          tmp_tr
            .append("td")
            .attr("role", "cell")
            .append("button")
            .text("X")
            .on("click", function () {
              table.select(`tr[name='${name}']`).remove();
              table_items = table_items.filter((d) => d.country.value != name);
              if (table_items.length == 0) {
                d3.select("#scatter_").attr("hidden", true);
              }
            });
        } else {
          let tds = table.select(`tr[name='${name}']`);
          tds.select("td:nth-child(2)").text(gdp_txt);
          tds.select("td:nth-child(3)").text(d3.format(".3~f")(gdp_change_txt));
          tds.select("td:nth-child(4)").text(school_txt);
          tds.select("td:nth-child(5)").text(positive_format(confirm_txt));
          tds.select("td:nth-child(6)").text(positive_format(death_txt));
        }
      }
      function addToTable(e) {
        let props = e.target.feature.properties,
          table = d3.select("#map_table tbody"),
          length = table.selectAll("tr").nodes().length;
        // limit to 7 element
        if (length < 7) {
          addTableRow(props.name);
        }
      }
      function clickFeature(e) {
        // zoomToFeature(e)
        addToTable(e);
      }
      function event_feature(x, layer) {
        layer.on({
          mouseover: highlightFeature,
          mouseout: resetHighlight,
          click: clickFeature,
        });
      }
      var map_filter = $L.control({ position: "bottomleft" });
      map_filter.onAdd = function () {
        // ADD more cases
        this._selectbox = $L.DomUtil.create("div", "map_filter info");
        this._selectbox.innerHTML =
          "<h5>Dimension:</h5>" +
          "<select id='map_attr_filter'>" +
          "<option value='confirm'>Daily Covid-19 Confirm</option>" +
          "<option value='death'>Daily Covid-19 Deaths</option>" +
          "<option value='school'>School Status</option>" +
          "<option value='gdp'>GDP</option>" +
          "</select>";
        return this._selectbox;
      };
      map_filter.addTo(map);

      map_filter_attr = d3.select("#map_attr_filter").node().value;
      async function createTileLayer() {
        let titleLayer = await $L.tileLayer(
          "https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token=" +
            mapboxAccessToken,
          {
            id: "mapbox/light-v9",
            attribution:
              '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
            tileSize: 512,
            zoomOffset: -1,
          }
        );
        titleLayer.addTo(map);
      }
      createTileLayer();
      var geojson;
      geojson = $L
        .geoJson(data, { style: mapstyle, onEachFeature: event_feature })
        .addTo(map);

      /* Info session*/

      var info = $L.control();
      info.onAdd = function () {
        // create a div with a class "info"
        this._div = $L.DomUtil.create("div", "info");
        // this.update();
        return this._div;
      };
      // method that we will use to update the control based on feature properties passed
      info.update = function (props) {
        if (props) {
          d3.select(".leaflet-top.leaflet-right .info").attr("hidden", null);
          this._div.innerHTML =
            "<h5>" +
            props.name +
            "</h5>" +
            (props.gdp[gdp_time(cur_time)]
              ? "<b>GDP:</b> " +
                gdp_format(props.gdp[cur_time.getFullYear()]) +
                " Bil. USD<br>" +
                "<b>Change in GDP:</b>" +
                d3.format(".3~f")(
                  ((props.gdp[cur_time.getFullYear()] -
                    props.gdp[cur_time.getFullYear() - 1]) /
                    props.gdp[cur_time.getFullYear() - 1]) *
                    100
                ) +
                "% <br>"
              : "") +
            (props.school[school_time(cur_time)]
              ? "<b>School Status:</b>" +
                props.school[school_time(cur_time)] +
                "<br/>"
              : "") +
            ((props.covid_confirm[health_time(cur_time)] != undefined) &
            (props.covid_confirm[health_time(cur_time)] >= 0)
              ? "<b>Daily Confirm:</b>" +
                positive_format(props.covid_confirm[health_time(cur_time)]) +
                "<br/>"
              : "") +
            ((props.covid_death[health_time(cur_time)] != undefined) &
            (props.covid_death[health_time(cur_time)] >= 0)
              ? "<b>Daily Deaths:</b>" +
                positive_format(props.covid_death[health_time(cur_time)]) +
                "<br/>"
              : "");
        } else {
          this._div.innerHTML = "";
          d3.select(".leaflet-top.leaflet-right .info").attr("hidden", "true");
        }
      };
      info.addTo(map);

      /* legend section */
      var legend = $L.control({ position: "bottomright" });
      legend.onAdd = function () {
        this._div = $L.DomUtil.create("div", "info legend");
        this.update();
        return this._div;
      };
      legend.update = function () {
        // TODO: ADD more cases
        if (map_filter_attr == "school") {
          this._div.innerHTML = "<h5>School Status:</h5>";
          let status = [
            "Closed due to COVID-19",
            "Partially open",
            "Academic break",
            "Fully open",
          ];
          for (let i = 0; i < status.length; i++) {
            this._div.innerHTML +=
              '<i style="background:' +
              color_school(status[i]) +
              '"></i> ' +
              status[i] +
              "<br>";
          }
        } else if (map_filter_attr == "death") {
          this._div.innerHTML = "<h5>Death Status:</h5>";
          let status = [
            "0-200",
            "200-400",
            "400-600",
            "600-800",
            "800-1,000",
            "1000+",
          ];
          let status_spec = [0, 200, 400, 600, 800, 1000];
          for (let i = 0; i < status.length; i++) {
            this._div.innerHTML +=
              '<i style="background:' +
              color_covid_death(status_spec[i]) +
              '"></i> ' +
              status[i] +
              "<br>";
          }
        } else if (map_filter_attr == "confirm") {
          this._div.innerHTML = "<h5>Confirm Status:</h5>";
          let status = [
            "0",
            "1-100",
            "100-1,000",
            "1,000-10,000",
            "10,000-100,000",
            "100,000+",
          ];
          let status_spec = [0, 1, 100, 1000, 10000, 100000];

          for (let i = 0; i < status.length; i++) {
            this._div.innerHTML +=
              '<i style="background:' +
              color_covid_confirm(status_spec[i]) +
              '"></i> ' +
              status[i] +
              "<br>";
          }
        } else if (map_filter_attr == "gdp") {
          this._div.innerHTML =
            "<h5>GDP in " +
            cur_time.getFullYear() +
            ":</h5>" +
            "<p><em>(Billions of U.S.dollars)</em></p>";

          let color_gdp = color_seq_log.domain(
            gdp_domain[cur_time.getFullYear()]
          );
          for (let i = 4; i >= 0; i--) {
            this._div.innerHTML +=
              '<i style="background:' +
              color_gdp(10 ** i) +
              '"></i> ' +
              10 ** i +
              "<br>";
          }
        }
        this._div.innerHTML +=
          '<i style="background:#B6B6B6"></i> Not Applicable';
      };
      legend.addTo(map);

      // Update the map if attribute is changed
      d3.select("#map_attr_filter").on("change", async function () {
        map_filter_attr = this.value;
        // console.log(this.value);
        await map.removeLayer(geojson);
        geojson = await $L
          .geoJson(data, {
            style: mapstyle,
            onEachFeature: event_feature,
          })
          .addTo(map);

        // update legend
        legend.update();
      });

      // Update the map if the time is changed
      d3.select("#slider1").on("change", async function () {
        cur_time = new Date(this.value * 1000);
        d3.select("#slider_date").text(cur_time.toDateString());
        // if (cur_time < time_low | cur_time >= time_upper) {
        // map.removeLayer(geojson)
        // geojson = L.geoJson(data, { style: mapstyle, onEachFeature: event_feature }).addTo(map)
        // }

        await map.removeLayer(geojson);
        geojson = await $L
          .geoJson(data, {
            style: mapstyle,
            onEachFeature: event_feature,
          })
          .addTo(map);

        // update table
        let table = d3.select("#map_table tbody");
        for (let i = 1; i <= table.selectAll("tr").nodes().length; i++) {
          addTableRow(table.select(`tr:nth-child(${i})`).attr("name"));
        }
        // update legend
        legend.update();
      });

      /* Scatter Plot Section*/
      let options = [
        { txt: "", value: "" },
        { txt: "GDP (Billions of U.S.dollars)", value: "gdp" },
        { txt: "Change in GDP (%)", value: "gdp_change" },
        { txt: "Daily Confirm", value: "confirm" },
        { txt: "Daily Death", value: "death" },
        { txt: "School Status", value: "school" },
      ];
      d3.select("#c0")
        .selectAll()
        .data(options)
        .enter()
        .append("option")
        .attr("value", (d) => d.value)
        .text((d) => d.txt);
      d3.select("#c1")
        .selectAll()
        .data(options)
        .enter()
        .append("option")
        .attr("value", (d) => d.value)
        .text((d) => d.txt);
      d3.select("#c2")
        .selectAll()
        .data(options.slice(0, -1))
        .enter()
        .append("option")
        .attr("value", (d) => d.value)
        .text((d) => d.txt);

      function scatterScale(plot_data, option) {
        let scale;
        if (option == "gdp") {
          scale = d3
            .scaleLinear()
            .domain(d3.extent(plot_data.map((d) => d.gdp.value)));
        } else if (option == "school") {
          scale = d3
            .scalePoint()
            .domain([
              "Closed due to COVID-19",
              "Partially open",
              "Academic break",
              "Fully open",
            ]);
        } else if (option == "confirm") {
          if (plot_data.filter((d) => d.confirm.value == 0).length > 0) {
            scale = d3
              .scaleLinear()
              .domain(d3.extent(plot_data.map((d) => d.confirm.value)));
          } else {
            scale = d3
              .scaleLog()
              .domain(d3.extent(plot_data.map((d) => d.confirm.value)));
          }
        } else if (option == "death") {
          if (plot_data.filter((d) => d.death.value == 0).length > 0) {
            scale = d3
              .scaleLinear()
              .domain(d3.extent(plot_data.map((d) => d.death.value)));
          } else {
            scale = d3
              .scaleLog()
              .domain(d3.extent(plot_data.map((d) => d.death.value)));
          }
        } else if (option == "gdp_change") {
          let extent = d3.extent(plot_data.map((d) => d.gdp_change.value)),
            low = extent[0],
            high = extent[1];
          if (low.constructor === String) {
            if (low[0] == "−") {
              low = -parseFloat(low.slice(1));
            }
          }

          if (high.constructor === String) {
            if (high[0] == "−") {
              high = -parseFloat(high.slice(1));
            }
          }
          scale = d3.scaleLinear().domain([low, high]);
        }
        return scale;
      }
      function plot_scatter(plot_data, c0, c1, c2) {
        var color_country, xScale, yScale, sizeScale;
        var svg = d3
          .select("#scatter_plot")
          .append("svg")
          .attr("width", "100%")
          .attr("height", "25vw");
        let minwidth = 700,
          minheight = 400;
        svg
          .attr(
            "width",
            d3.max([
              minwidth,
              parseInt(d3.select("#scatter_plot svg").style("width")),
            ])
          )
          .attr(
            "height",
            d3.max([
              minheight,
              parseInt(d3.select("#scatter_plot svg").style("height")),
            ])
          );

        var margin = { top: 50, left: 150, bottom: 50, right: 180 },
          width =
            parseInt(d3.select("#scatter_plot svg").style("width")) -
            margin.left -
            margin.right,
          height =
            parseInt(d3.select("#scatter_plot svg").style("height")) -
            margin.top -
            margin.bottom,
          g = svg
            .append("g")
            .attr(
              "transform",
              "translate(" + margin.left + ", " + margin.top + ")"
            );
        color_country = d3.scaleOrdinal(
          plot_data.map((d) => d.country.value),
          d3.schemePaired.slice(0, table_items.length)
        );
        // Add legend
        var legend = svg
          .append("g")
          .attr(
            "transform",
            "translate(" + (margin.left + width) + "," + margin.top / 2 + ")"
          )
          .selectAll()
          .data(plot_data)
          .enter();

        // add date information
        legend
          .append("text")
          .attr("x", 15)
          .attr("y", -10)
          .classed("scatter_date", true)
          .text(cur_time.toDateString());

        // add legend label
        legend
          .append("text")
          .attr("x", 60)
          .attr("y", (_, i) => margin.top + i * 30)
          .classed("graphlegend", true)
          .text((d) => d.country.value);
        // add legend label color
        legend
          .append("circle")
          .attr("cx", 40)
          .attr("cy", (_, i) => margin.top - 3 + i * 30)
          .attr("r", 10)
          .attr("fill", (d) => color_country(d.country.value))
          .classed("graphlegend", true);

        //define scaler
        xScale = scatterScale(plot_data, c0);
        yScale = scatterScale(plot_data, c1);
        sizeScale = scatterScale(plot_data, c2);
        xScale.range([0, width]);
        yScale.range([height, 0]);
        sizeScale.range([10, d3.min([width, height]) / 15]);

        // define X axis & Y axis
        var xAxis = d3.axisBottom().scale(xScale),
          yAxis = d3.axisLeft().scale(yScale);
        yAxis.ticks(Math.max(height / 100, 2)); //one every 100 pixels
        xAxis.ticks(Math.max(width / 100, 2));
        g.append("g")
          .classed("axis", true)
          .attr("transform", "translate(0," + height + ")")
          .call(xAxis)
          .append("text")
          .attr("x", width / 2) //middle of the xAxis
          .attr("y", 40) // a little bit below xAxis
          .text(() => {
            if (c0 == "gdp") {
              return "GDP (bil $)";
            } else {
              return plot_data[0][c0].key;
            }
          })
          .classed("axisTitle", true);

        g.append("g")
          .classed("axis", true)
          .call(yAxis)
          .append("text")
          .attr("transform", "rotate(-90)")
          .attr("x", -height / 2 + margin.top)
          .attr("y", -100)
          .classed("axisTitle", true)
          .text(() => {
            if (c1 == "gdp") {
              return "GDP (bil $)";
            } else {
              return plot_data[0][c1].key;
            }
          });
        g.append("g")
          .classed("bubble", true)
          .selectAll("circle")
          .data(plot_data)
          .enter()
          .append("circle")
          .attr("cx", (d) => xScale(d[c0].value))
          .attr("cy", (d) => yScale(d[c1].value))
          .attr("r", (d) => sizeScale(d[c2].value))
          .attr("fill", (d) => color_country(d.country.value))
          .on("mouseover", function () {
            d3.select(this).attr("stroke", "gray").attr("stroke-width", "4px");
          })
          .on("mouseout", function () {
            d3.select(this).attr("stroke", "null");
          })
          .append("title")
          .text((d) => {
            if (c2 == "gdp_change") {
              return `${d.country.value}: ${d3.format(".3~f")(d[c2].value)}%`;
            } else if (c2 == "gdp") {
              return `${d.country.value}: ${gdp_format(d[c2].value)}`;
            } else {
              return `${d.country.value}: ${positive_format(d[c2].value)}`;
            }
          });
      }

      d3.select("#scatter_button").on("click", function () {
        // console.log(table_items);
        var c0 = document.getElementById("c0").value;
        var c1 = document.getElementById("c1").value;
        var c2 = document.getElementById("c2").value;
        var plot_data;
        if (
          (c0 != c1) &
          (c1 != c2) &
          (c0 != c2) &
          ((c0 != "") & (c0 != undefined)) &
          ((c1 != "") & (c1 != undefined)) &
          ((c2 != "") & (c2 != undefined))
        ) {
          plot_data = table_items.filter(
            (d) =>
              !["", undefined].includes(d[c0].value) &
              !["", undefined].includes(d[c1].value) &
              !["", undefined].includes(d[c2].value)
          );
        } else {
          plot_data = undefined;
          d3.select("#scatter_plot svg").remove();
        }
        resize(plot_data, c0, c1, c2);
        d3.select(window).on("resize", () => {
          resize(plot_data, c0, c1, c2);
        });
        function resize(plot_data, c0, c1, c2) {
          // console.log(plot_data)
          if (plot_data) {
            d3.select("#scatter_plot svg").remove();
            plot_scatter(plot_data, c0, c1, c2);
          }
        }
      });

      // Inititiate the page
      addTableRow("China");
      addTableRow("United States");
      addTableRow("India");
      addTableRow("Turkey");

      document.getElementById("c0").value = "gdp";
      document.getElementById("c1").value = "school";
      document.getElementById("c2").value = "confirm";
      document.getElementById("scatter_button").click();
    });
  },
};
</script>

<!-- Add "scoped" attribute to limit CSS to this component only -->
<style >
.map-home {
  /* height: 500px;
                width: 600px; */
  height: 25vw;
  width: 95vw;
  /* margin-top: 50px; */
  margin-bottom: 20px;
  display: inline-block;
}

.info {
  padding: 6px 8px;
  font: 14px/16px Arial, Helvetica, sans-serif;
  background: white;
  background: rgba(255, 255, 255, 0.8);
  box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
  border-radius: 5px;
}

.info h5 {
  margin: 0 0 5px;
  color: #777;
}

.legend {
  line-height: 18px;
  color: #555;
}

.legend i {
  width: 18px;
  height: 18px;
  float: left;
  margin-right: 8px;
  opacity: 0.7;
}

#map_table {
  margin: 40px 10vw;
  height: auto;
  /* text-align: center; */
  padding: 0.5rem;
  font-size: 1.5rem;
  /* font-family: Cuprum; */
  line-height: 150%;
}
#map_table tbody tr:hover {
  background: yellow;
}

/*
#map_table table tr td,
#map_table table tr th {
  border: 1px solid black;
  padding: 10px;
  width: 100px;
  height: 20px;
} */
#scatter_plot text.axisTitle {
  font-size: 1.5em;
  fill: black;
  font-weight: bold;
}
#scatter_plot .graphlegend {
  font-size: 0.85em;
}
#scatter_plot text.scatter_date {
  font-size: 1.2em;
  fill: gray;
  font-weight: bold;
}
#scatter_plot .tick text {
  font-size: 1em;
}
#scatter_plot .bubble circle {
  opacity: 0.8;
}

#scatter_plot {
  margin-bottom: 50px;
}
ul {
  display: table;
  margin: 0 auto;
  text-align: left;
}
</style>